"use strict";const e=require("../../common/vendor.js"),s=require("../../utils/business.js"),t={data:()=>({imgUrlArr:[],drawImgs:[],successUpload:!1,canvasHeight:0,canvasWidth:0,savaImgDatas:[]}),methods:{chooseImage(){e.index.chooseImage({success:e=>{this.imgUrlArr=[...this.imgUrlArr,...e.tempFilePaths],console.log("this.imgUrlArr:",this.imgUrlArr),this.canvasHeight=0,this.loadImg()}})},saveImage(){e.index.canvasToTempFilePath({canvasId:"imgBed",fileType:"jpg",x:0,y:0,width:this.canvasWidth,height:this.canvasHeight,success:t=>{this.savaImgDatas.push(t.tempFilePath),s.saveImage2Photo("canvas",this.savaImgDatas),e.index.showToast({title:"图片保存成功"})},fail:s=>{e.index.showToast({title:"图片保存失败"})}},this)},loadImg(){e.index.getWindowInfo();e.index.createSelectorQuery().in(this).select("#imgBed").boundingClientRect((s=>{const t=e.index.createCanvasContext("imgBed",this);for(let i=0;i<this.imgUrlArr.length;i++)e.index.getImageInfo({src:this.imgUrlArr[i],success:s=>{let a=s.width,h=s.height;const{screenWidth:r}=e.index.getWindowInfo(),c=parseInt(.95*r);this.canvasWidth=c;const g=(a/h).toFixed(2),n=parseInt(c/g);if(this.drawImgs[i]={height:n,path:this.imgUrlArr[i],width:c},i===this.imgUrlArr.length-1){const e=this.drawImgs.map((e=>e.height)).reduce(((e,s)=>e+s),0);console.log("fullHeight:",e),this.canvasHeight=e,this.drawImgs.forEach(((e,s)=>{const{height:i,path:a,width:h}=e,r=this.drawImgs.slice(0,s).map((e=>e.height)).reduce(((e,s)=>e+s),0);t.drawImage(a,0,r,h,i)})),t.draw(),this.successUpload=!0}}})})).exec()}}};const i=e._export_sfc(t,[["render",function(s,t,i,a,h,r){return{a:h.canvasHeight+"px",b:e.o(((...e)=>r.chooseImage&&r.chooseImage(...e))),c:e.o(((...e)=>r.saveImage&&r.saveImage(...e))),d:h.successUpload}}]]);wx.createPage(i);
