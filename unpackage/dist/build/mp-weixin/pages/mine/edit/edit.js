"use strict";const a=require("../../../common/vendor.js");var e=getApp();const t={data:()=>({avatar:"",nickname:"",uid:""}),onShow:function(){},methods:{async init(){const{avatar:t,nickname:n}=e.globalData.userInfo,{uid:i}=a.Bs.getCurrentUserInfo();this.avatar=t,this.nickname=n,this.uid=i},onChooseAvatar(t){const{avatarUrl:n}=t.detail;a.Bs.importObject("uni-id-co"),console.log("avatar:",n),a.index.showLoading({title:"头像上传中..."}),a.Bs.uploadFile({filePath:n,cloudPath:`images/${Date.now()}.jpeg`,success:t=>{console.log("res:",t),a.index.hideLoading(),this.avatar=n,e.globalData.userInfo.avatar=n;const{fileID:i}=t;a.Bs.database().collection("uni-id-users").doc(this.uid).update({avatar:i})},complete(){a.index.hideLoading()}})},async handleEditUser(){a.Bs.database().collection("uni-id-users").doc(this.uid).update({nickname:this.nickname}).then((async t=>{const{errCode:n}=t;if(!n){const t=a.Bs.database();console.log("this.uid:",this.uid);const n=await t.collection("uni-id-users").doc(this.uid).field({nickname:!0,avatar:!0}).get(),{data:i}=n.result;console.log("userRecord:",n),e.globalData.userInfo.nickname=i[0].nickname,a.index.showToast({icon:"success",title:"编辑成功！",success(){a.index.navigateBack()}})}}))}},created(){this.init()}};const n=a._export_sfc(t,[["render",function(e,t,n,i,o,s){return{a:o.avatar,b:a.o(((...a)=>s.onChooseAvatar&&s.onChooseAvatar(...a))),c:o.nickname,d:a.o((a=>o.nickname=a.detail.value)),e:a.o(((...a)=>s.handleEditUser&&s.handleEditUser(...a)))}}]]);wx.createPage(n);
