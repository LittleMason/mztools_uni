"use strict";const a=require("../../../common/vendor.js");var e=getApp();const t={data:()=>({avatar:"",nickname:"",uid:""}),onShow:function(){},methods:{async init(){const{avatar:t,nickname:n}=e.globalData.userInfo;a.Ds.importObject("uni-id-co");const{uid:o}=a.Ds.getCurrentUserInfo();this.avatar=t,this.nickname=n,this.uid=o},onChooseAvatar(t){const{avatarUrl:n}=t.detail;a.Ds.importObject("uni-id-co"),console.log("avatar:",n),a.index.showLoading({title:"头像上传中..."}),a.Ds.uploadFile({filePath:n,cloudPath:`images/${Date.now()}.jpeg`,success:t=>{console.log("res:",t),a.index.hideLoading(),this.avatar=n,e.globalData.userInfo.avatar=n;const{fileID:o}=t;a.Ds.database().collection("uni-id-users").doc(this.uid).update({avatar:o})},complete(){a.index.hideLoading()}})},async handleEditUser(){a.Ds.database().collection("uni-id-users").doc(this.uid).update({nickname:this.nickname}).then((async t=>{const{errCode:n}=t;if(!n){const t=a.Ds.database(),n=await t.collection("uni-id-users").doc(this.uid).field({nickname:!0,avatar:!0}).get(),{data:o}=n.result;console.log("userRecord:",n),e.globalData.userInfo.nickname=o[0].nickname,a.index.showToast({icon:"success",title:"编辑成功！",success(){a.index.navigateBack()}})}}))}},created(){console.log("created"),this.init()}};const n=a._export_sfc(t,[["render",function(e,t,n,o,i,s){return{a:i.avatar,b:a.o(((...a)=>s.onChooseAvatar&&s.onChooseAvatar(...a))),c:i.nickname,d:a.o((a=>i.nickname=a.detail.value)),e:a.o(((...a)=>s.handleEditUser&&s.handleEditUser(...a)))}}]]);wx.createPage(n);
